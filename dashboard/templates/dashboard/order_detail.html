{% load static %}
{% load tz %}
{% load formatters %}

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chi ti·∫øt ƒë∆°n</title>
  <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>
<body>

<!-- =========================
     HEADER
     ========================= -->
<header class="header">
  <div class="header-inner">
    <a class="logo" href="{% url 'dashboard' %}">
      <span class="logo-badge">M</span><span>MilkStore</span>
    </a>

    <div class="actions">
      <a class="btn secondary" href="{% url 'my_orders' %}">‚Üê ƒê∆°n h√†ng</a>
      <a class="cart" href="{% url 'to_view_cart' %}">
        üõí Gi·ªè h√†ng <span class="badge">{{ total_cart_item|default:0 }}</span>
      </a>
    </div>
  </div>
</header>

<main class="wrap">

  <!-- =========================
       TITLE
       ========================= -->
  <div class="section-head" style="margin-top:10px;">
    <h2 style="margin:0;">ƒê∆°n #{{ order.order_id }}</h2>
    <span class="muted">
      Tr·∫°ng th√°i: <b>{{ order.status }}</b>
    </span>
  </div>

  <!-- =========================
       ORDER SUMMARY + RECEIVER INFO
       ========================= -->
  <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px;">

    <!-- Th√¥ng tin ƒë∆°n -->
    <div class="card">
      <div style="color:var(--muted); font-size:13px;">Ng√†y t·∫°o</div>
      <div style="font-weight:900; margin-top:4px;">
        {{ order.created_at|localtime|date:"d/m/Y H:i" }}
      </div>

      <div style="height:10px;"></div>

      <div style="color:var(--muted); font-size:13px;">T·ªïng ti·ªÅn</div>
      <div style="font-weight:900; font-size:20px; margin-top:4px;">
        {{ order.total_amount|vnd }}
      </div>
    </div>

    <!-- Th√¥ng tin ng∆∞·ªùi nh·∫≠n -->
    <div class="card">
      <div style="font-weight:900; margin-bottom:8px;">Th√¥ng tin ng∆∞·ªùi nh·∫≠n</div>

      <div style="display:grid; gap:6px;">
        <div>
          <span style="color:var(--muted); font-size:13px;">H·ªç t√™n</span><br>
          <b>{{ order.receiver_name|default:"(ch∆∞a c√≥)" }}</b>
        </div>

        <div>
          <span style="color:var(--muted); font-size:13px;">S·ªë ƒëi·ªán tho·∫°i</span><br>
          <b>{{ order.receiver_phone|default:"(ch∆∞a c√≥)" }}</b>
        </div>

        <div>
          <span style="color:var(--muted); font-size:13px;">ƒê·ªãa ch·ªâ</span><br>
          <b>{{ order.receiver_address|default:"(ch∆∞a c√≥)" }}</b>
        </div>
      </div>
    </div>

  </div>

  <!-- =========================
       ITEMS
       ========================= -->
  <h3 style="margin:14px 0 10px;">S·∫£n ph·∫©m</h3>

  {% get_media_prefix as MEDIA %}

  <div class="grid" style="grid-template-columns:1fr; gap:12px;">
    {% for it in items %}
      <div class="card" style="display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;">

        <!-- LEFT: image + name -->
        <div style="display:flex; gap:12px; align-items:center; min-width:260px;">

          <!-- ·∫¢nh s·∫£n ph·∫©m: ∆∞u ti√™n ·∫£nh t·ª´ Product, fallback ·∫£nh ƒë√£ l∆∞u theo t√™n file -->
          <div style="width:70px; height:70px; border-radius:12px; overflow:hidden; border:1px solid rgba(15,23,42,.10); background:#fff;">
            {% if it.product and it.product.image %}
              <img src="{{ it.product.image.url }}" alt="{{ it.product_name }}" style="width:100%; height:100%; object-fit:cover;">
            {% elif it.product_image_name %}
              <img src="{{ MEDIA }}{{ it.product_image_name }}" alt="{{ it.product_name }}" style="width:100%; height:100%; object-fit:cover;">
            {% else %}
              <div style="width:100%; height:100%; display:grid; place-items:center; color:var(--muted); font-size:12px;">
                No image
              </div>
            {% endif %}
          </div>

          <!-- T√™n + ƒë∆°n gi√° x s·ªë l∆∞·ª£ng -->
          <div>
            <div style="font-weight:900;">{{ it.product_name }}</div>
            <div style="color:var(--muted); font-size:13px;">
              {{ it.unit_price|vnd }} √ó {{ it.quantity }}
            </div>
          </div>

        </div>

        <!-- RIGHT: line total -->
        <div style="text-align:right;">
          <div style="color:var(--muted); font-size:13px;">Th√†nh ti·ªÅn</div>

          {# ∆ØU TI√äN: line_total n·∫øu ƒë√£ set ·ªü view #}
          {% if it.line_total %}
            <div style="font-weight:900;">{{ it.line_total|vnd }}</div>
          {% else %}
            {# NOTE: N·∫øu ch∆∞a set line_total, template kh√¥ng ti·ªán nh√¢n unit_price*quantity.
               Khuy·∫øn ngh·ªã: t√≠nh line_total trong view ƒë·ªÉ hi·ªÉn th·ªã chu·∫©n. #}
            <div style="font-weight:900;">{{ it.unit_price|vnd }}</div>
          {% endif %}
        </div>

      </div>
    {% empty %}
      <p class="muted">Kh√¥ng c√≥ s·∫£n ph·∫©m trong ƒë∆°n.</p>
    {% endfor %}
  </div>

  <!-- =========================
       TOTAL + CONTINUE SHOPPING
       ========================= -->
  <div class="card" style="margin-top:14px; display:flex; justify-content:space-between; align-items:center;">
    <div>
      <div style="color:var(--muted); font-size:13px;">T·ªïng thanh to√°n</div>
      <div style="font-size:20px; font-weight:900;">{{ order.total_amount|vnd }}</div>
    </div>

    <a class="btn secondary" href="{% url 'dashboard' %}">Ti·∫øp t·ª•c mua</a>
  </div>

</main>

</body>
</html>
