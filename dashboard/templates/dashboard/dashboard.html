{% load static %}
{% load formatters %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trang ch·ªß</title>

  <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <a class="logo" href="{% url 'dashboard' %}">
        <span class="logo-badge">M</span>
        <span>MilkStore</span>
      </a>

      <form class="search" action="{% url 'dashboard' %}" method="get">
        <input type="text" name="q" value="{{ q|default:'' }}" placeholder="T√¨m s·ªØa, b·ªâm, vitamin..." />
        <button class="chip" type="submit">T√¨m</button>
      </form>

      <div class="actions">
        {% if account and account.role == "ADMIN" %}
          <a class="btn secondary" href="{% url 'to_admin_page' %}">Admin</a>
        {% endif %}

        <a class="cart" href="{% url 'to_view_cart' %}">
          üõí Gi·ªè h√†ng
          <span class="badge">{{ total_cart_item|default:0 }}</span>
        </a>

        {% if not request.session.account_id %}
          <a class="btn secondary" href="{% url 'to_login_page' %}">ƒêƒÉng nh·∫≠p</a>
          <a class="btn primary" href="{% url 'to_register_page' %}">ƒêƒÉng k√≠</a>
        {% else %}
          <span class="chip">V√≠: <b>{{ balance|vnd }}</b></span>
          <a class="btn secondary" href="{% url 'wallet_topup' %}">N·∫°p v√≠</a>
          <a class="btn secondary" href="{% url 'my_orders' %}">ƒê∆°n h√†ng</a>
          <a class="btn secondary" href="{% url 'logout' %}">ƒêƒÉng xu·∫•t</a>
        {% endif %}
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Hero -->
    <section class="hero">
      <div>
        <h1>Web b√°n s·ªØa ch√≠nh h√£ng<br/>gi√° t·ªët m·ªói ng√†y</h1>
        <p>
          Ch·ªçn s·ªØa ph√π h·ª£p cho b√© v√† gia ƒë√¨nh. ∆Øu ƒë√£i theo combo, giao nhanh, h·ªó tr·ª£ ƒë·ªïi tr·∫£.
        </p>

        <div class="hero-cta">
          <a class="btn primary" href="#products">Xem s·∫£n ph·∫©m</a>
          <a class="btn secondary" href="{% url 'to_view_cart' %}">Xem gi·ªè h√†ng</a>

          {% if not request.session.account_id %}
            <a class="btn secondary" href="{% url 'to_login_page' %}">ƒêƒÉng nh·∫≠p ƒë·ªÉ mua</a>
          {% else %}
            <a class="btn secondary" href="{% url 'wallet_topup' %}">N·∫°p v√≠</a>
          {% endif %}
        </div>
      </div>

      <div class="hero-art" aria-label="banner"></div>
    </section>

    <!-- Trust / info -->
    <section class="grid">
      <div class="card">
        <p class="card-title">‚úÖ H√†ng ch√≠nh h√£ng</p>
        <p class="card-sub">Cam k·∫øt ngu·ªìn g·ªëc r√µ r√†ng, h·∫°n d√πng minh b·∫°ch.</p>
      </div>
      <div class="card">
        <p class="card-title">üöö Giao nhanh</p>
        <p class="card-sub">Giao n·ªôi th√†nh nhanh, theo d√µi ƒë∆°n d·ªÖ d√†ng.</p>
      </div>
      <div class="card">
        <p class="card-title">üí≥ Thanh to√°n an to√†n</p>
        <p class="card-sub">H·ªó tr·ª£ nhi·ªÅu ph∆∞∆°ng th·ª©c, b·∫£o m·∫≠t th√¥ng tin.</p>
      </div>
    </section>

    <!-- Featured products -->
    <section class="section" id="products">
      <div class="section-head">
        {% if q %}
          <h2>K·∫øt qu·∫£ t√¨m ki·∫øm: ‚Äú{{ q }}‚Äù</h2>
          <span class="muted">T√¨m th·∫•y {{ search_count }} s·∫£n ph·∫©m</span>
        {% else %}
          <h2>S·∫£n ph·∫©m n·ªïi b·∫≠t</h2>
          <span class="muted">Gi√° t·ªët ‚Äì ch√≠nh h√£ng</span>
        {% endif %}
      </div>

      <div class="product-grid">
        {% for p in products %}
          <div class="product-card">

            <!-- ‚úÖ Click ·∫£nh -> detail -->
            <a class="product-img" href="{% url 'product_detail' p.product_id %}">
              {% if p.image %}
                <img src="{{ p.image.url }}" alt="{{ p.product_name }}">
              {% else %}
                <div class="muted">Ch∆∞a c√≥ ·∫£nh</div>
              {% endif %}
            </a>

            <!-- ‚úÖ Click t√™n -> detail -->
            <a class="product-name" href="{% url 'product_detail' p.product_id %}">
              {{ p.product_name }}
            </a>

            <div class="product-meta">
              <div class="product-price">{{ p.price|vnd }}</div>
              <div class="product-cat">{{ p.category.category_name }}</div>
            </div>

            <div class="product-desc">{{ p.description }}</div>
            <div class="muted" style="font-size:12px;">Giao nhanh ‚Ä¢ ƒê·ªïi tr·∫£ 7 ng√†y</div>

            {% if request.session.account_id %}
              <a class="btn primary product-btn" href="{% url 'add_to_cart' p.product_id %}">
                Th√™m v√†o gi·ªè
              </a>
            {% else %}
              <a class="btn secondary product-btn" href="{% url 'to_login_page' %}">
                ƒêƒÉng nh·∫≠p ƒë·ªÉ mua
              </a>
            {% endif %}
          </div>
        {% empty %}
          <p class="muted">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o. V√†o Admin ƒë·ªÉ th√™m s·∫£n ph·∫©m.</p>
        {% endfor %}
      </div>
    </section>

    <!-- Logged-in account summary -->
    {% if request.session.account_id %}
      <section class="account">
        <div>
          <div style="color:var(--muted); font-size:13px;">Xin ch√†o</div>
          <div style="font-size:18px; font-weight:900;">{{ account.username }}</div>
        </div>

        <div class="kpis">
          <div class="kpi">
            <small>S·ªë d∆∞ v√≠</small>
            <b>{{ balance|vnd }}</b>
          </div>
          <div class="kpi">
            <small>Trong gi·ªè h√†ng</small>
            <b>{{ total_cart_item }} s·∫£n ph·∫©m</b>
          </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
          <a class="btn secondary" href="{% url 'wallet_topup' %}">N·∫°p v√≠</a>
          <a class="btn secondary" href="{% url 'my_orders' %}">Xem ƒë∆°n h√†ng</a>
          <a class="btn primary" href="{% url 'to_view_cart' %}">ƒêi t·ªõi gi·ªè h√†ng</a>
        </div>
      </section>
    {% endif %}
  </main>
</body>
</html>
